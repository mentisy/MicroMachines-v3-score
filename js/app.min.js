$(document).ready(function(){App.setup()});var App={setup:function(){this.monitorPhaseButtons(),Game.checkExistingGame()},monitorPhaseButtons:function(){this.findRole("start-game").on("click",function(){Game.start()}),this.findRole("round-score-selector").find("div.btn").on("click",function(){var e=$(this).parent().data("player");if(!1===$(this).data("pressed")){$(this).data("pressed",!0).attr("data-pressed",!0);var t=$(this).data("roundpos");Game.saveRoundData(e,t)}else Game.regretRoundData(e),$(this).data("pressed",!1).attr("data-pressed",!1),$(this).parent().find(".btn").show();var o=App.findRole("round-score-selector").find("[data-pressed=true]").length;Game.countPlayers()===o?App.findRole("save-round").show():App.findRole("save-round").hide()}),this.findRole("save-round").on("click",function(){Game.saveRound()}),this.findRole("reset").on("click",function(){Game.reset()}),this.findRole("save").on("click",function(){Game.declareWinner()}),this.findRole("continue").on("click",function(){$(".winner").hide()})},findRole:function(e){return $('[data-role="'+e+'"]')}},Game={defaultPlayers:5,points:{1:30,2:20,3:10,4:0,5:0},checkExistingGame:function(){var e=this.getRound();!isNaN(e)&&e>0&&(this.start(),App.findRole("reset").show(),App.findRole("save").show());var t=this.countPlayers();(isNaN(t)||0===t)&&Cookies.write("Players.count",this.defaultPlayers)},start:function(){App.findRole("start-game").hide(),this.setupPlayers()},setupPlayers:function(){this.setupTablePlayers([]),this.beginRound()},setupTablePlayers:function(e){var t="<td></td>",o=this.countPlayers(),n=this.getRound(),r=1,a=0;for(t="";r<=n;){for(t+="<tr><td class='pl-2 pl-md-3 pr-2 pr-md-3'>R<span class=\"d-none d-md-inline-block\">unde</span> "+r+"</td>";a<(o||100);)t+="<td>"+Cookies.read("Round"+r+".Player"+a+".score")+"</td>",a++;t+="</tr>",a=0,r++}var s=App.findRole("scoresheet").show().find('[data-role="table-total"]');for(s.before(t),a=0;a<(o||100);){var i=parseInt(Cookies.read("Player"+a+".score")),d=a+2;s.children(":nth-child("+d+")").html(i),a++}},beginRound:function(){App.findRole("round-score-selector").show()},saveRoundData:function(e,t){$('[data-role="round-score-selector"][data-player="'+e+'"]').find(':not([data-roundpos="'+t+'"])').hide(),Cookies.write("roundUnsaved.Player"+e,t)},regretRoundData:function(e){Cookies.delete("roundUnsaved.Player"+e)},saveRound:function(){var e=this.getUnsavedRoundPositions(),t=[];$.each(e,function(e,o){t.push({player:o.player,score:Game.points[parseInt(o.position)]})});var o=this.getRound();isNaN(o)&&(o=0),o++,Cookies.write("Round.count",o),this.appendScores(t),App.findRole("table-total").children(":not(:first)").each(function(e,t){var o=Cookies.read("Player"+e+".score");$(t).text(o)}),App.findRole("save").show(),App.findRole("reset").show(),this.resetRound()},resetRound:function(){App.findRole("save-round").hide(),App.findRole("round-score-selector").find("div.btn").show().data("pressed",!1).attr("data-pressed",!1)},appendScores:function(e){var t=this.getRound(),o='<tr><td class="pl-2 pl-md-3 pr-2 pr-md-3">R<span class="d-none d-md-inline-block">unde</span> '+t+"</td>";$.each(e,function(e,n){var r=parseInt(Cookies.read("Player"+n.player+".score"));isNaN(r)&&(r=0),Cookies.write("Round"+t+".Player"+n.player+".score",n.score),Cookies.write("Player"+n.player+".score",r+n.score),Cookies.write("roundUnsaved.Player"+n.player,0),o+="<td>"+n.score+"</td>"}),o+="</tr>",App.findRole("table-total").before(o)},savePlayers:function(e){$.each(e,function(e,t){Cookies.write("Player"+e+".name",t.value)}),Cookies.write("Players.count",e.length)},findPlayers:function(){for(var e=this.countPlayers(),t=[],o=0;o<e;)t.push(Cookies.read("Player"+o+".name")),o++;return t},getUnsavedRoundPositions:function(){var e=this.countPlayers();i=0;for(var t=[];i<e;)t.push({player:i,position:Cookies.read("roundUnsaved.Player"+i)}),i++;return t},declareWinner:function(){for(var e=this.countPlayers(),t=-1,o=0,n=0;t++<e-1;){var r=Cookies.read("Player"+t+".score");r>o&&(o=r,n=t)}var a=(n=$("[data-role='profile'][data-player='"+n+"']")).find("img").attr("src"),s=n.find("figcaption").text();(n=$(".winner")).find('h3[data-role="winner-name"]').text(s),n.find('img[data-role="winner-image"]').attr("src",a),n.show()},countPlayers:function(){return parseInt(Cookies.read("Players.count"))},getRound:function(){return parseInt(Cookies.read("Round.count"))},reset:function(){Cookies.clear(),window.location.href=""}},Cookies={prefix:"MM-",read:function(e){return localStorage.getItem(this.prefix+e)},write:function(e,t){localStorage.setItem(this.prefix+e,t)},delete:function(e){localStorage.removeItem(this.prefix+e)},clear:function(){for(var e=Object.keys(localStorage),t=e.length;t--;)-1!==e[t].indexOf(this.prefix)&&localStorage.removeItem(e[t])}};